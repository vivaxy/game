var jiugongge=function(){!function(){for(var t=0,e=["ms","moz","webkit","o"],n=0;n<e.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[e[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[n]+"CancelAnimationFrame"]||window[e[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var n=(new Date).getTime(),o=Math.max(0,16-(n-t)),i=window.setTimeout(function(){e(n+o)},o);return t=n+o,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var t=function(){this.events={}};t.prototype.on=function(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)},t.prototype.fire=function(t,e){var n=this.events[t];n&&n.forEach(function(t){t(e)})};var e=function(t,e,n,o,i){this.element=t,this.styles=this.getStyle(e,n),this.style_from=this.getStyleValue(this.styles,e),this.style_to=this.getStyleValue(this.styles,n),this.time=o,this.beginTime=(new Date).getTime(),this.callback=i||function(){}};e.prototype.play=function(t){return t&&(this.callback=t),this.beginTime=(new Date).getTime(),this.loop(),this},e.prototype.loop=function(){var t=(new Date).getTime();if(t<this.beginTime+this.time){for(var e=0;e<this.styles.length;e++){var n=this.styles[e];this.element.style[n]=this.calculateStyle(e,t)}requestAnimationFrame(this.loop.bind(this))}else{for(var o=0;o<this.styles.length;o++)this.element.style[this.styles[o]]=this.style_to[o];this.callback()}return this},e.prototype.getStyle=function(t,e){for(var n=Object.keys(t),o=Object.keys(e),i=[],r=0;r<n.length;r++)o.indexOf(n[r])>-1&&i.push(n[r]);return i},e.prototype.getStyleValue=function(t,e){for(var n=[],o=0;o<t.length;o++)n.push(e[t[o]]);return n},e.prototype.calculateStyle=function(t,e){var n,o,i;if(this.style_from[t].indexOf("rotateY")>-1)return n=parseInt(this.style_from[t].replace("rotateY(","").replace("deg)","")),o=parseInt(this.style_to[t].replace("rotateY(","").replace("deg)","")),i=n+(o-n)/this.time*(e-this.beginTime),"rotateY("+i+"deg)";if(this.style_from[t].indexOf("px")>-1)return n=parseInt(this.style_from[t].replace("px","")),o=parseInt(this.style_to[t].replace("px","")),i=n+(o-n)/this.time*(e-this.beginTime),i+"px";throw new Error("style error")};var n=function(e){this.options={container:document.querySelector(".jiugongge"),size:90,spacing:4,interval:100,winningImage:"prize.png",prizeImages:["prize0.png","prize1.png","prize2.png","prize3.png","button.png","prize4.png","prize5.png","prize6.png","prize7.png"],coverImages:["cover.png","cover.png","cover.png","cover.png","cover.png","cover.png","cover.png","cover.png","cover.png"],callback:function(){}},this.messenger=new t,this.status="GRID_READY",this.init(e)};n.prototype.appendElements=function(){var t=this,e=document.createElement("div");e.style.position="relative",e.style.margin="0 auto",e.style.width=3*t.options.size+2*t.options.spacing+"px",e.style.height=3*t.options.size+2*t.options.spacing+"px";for(var n=0;9>n;n++){var o=t.convert(n).col,i=t.convert(n).row,r=o*t.options.size+o*t.options.spacing,s=i*t.options.size+i*t.options.spacing,a={position:"absolute",width:t.options.size+"px",height:t.options.size+"px",left:r+"px",top:s+"px",zIndex:0},p=document.createElement("div");t.setStyle(p,a),t.data(p,"data-row",i),t.data(p,"data-col",o),t.bindEvents(p);var l=document.createElement("img");l.src=t.options.prizeImages[n],l.width=l.height=t.options.size,l.style.position="absolute";var c=document.createElement("img");c.src=t.options.coverImages[n],c.width=c.height=t.options.size,c.style.position="absolute",c.style.display="none",p.appendChild(c),p.appendChild(l),e.appendChild(p)}return t.options.container.appendChild(e),t},n.prototype.overwriteOptions=function(t){var e=this;if(t)for(var n in this.options)if(t[n]){if(("prizeImages"==n||"coverImages"==n)&&"string"==typeof t[n]){var o=t[n];t[n]=[];for(var i=0;9>i;i++)t[n].push(o)}if(("prizeImages"==n||"coverImages"==n)&&"object"==typeof t[n]&&9!=t[n].length)throw new Error(n+" length not equals 9");e.options[n]=t[n]}return e},n.prototype.bindEvents=function(t){var e=this;return t.addEventListener("click",function(t){var n=e.data(t.target.parentNode,"data-row"),o=e.data(t.target.parentNode,"data-col");"GRID_READY"==e.status&&1==n&&1==o&&e.messenger.fire("START"),"PRIZE_READY"==e.status&&(e.status="PRIZE_SHOWN",e.messenger.fire("REVEAL"),e.flip(t.target.parentNode,function(){e.messenger.fire("REVEALED"),e.options.callback()}))}),e},n.prototype.init=function(t){var e=this;return e.overwriteOptions(t).appendElements(),e},n.prototype.disturb=function(t){var e=this;return e.status="GRID_START",e.flipAll(function(){e.appendWinningImage(),e.pause(function(){e.moveToCenterAll(function(){e.pause(function(){e.moveApartAll(function(){e.status="PRIZE_READY",e.messenger.fire("DISTURBED"),t&&t()})})})})}),e},n.prototype.moveApartAll=function(t){var e=this,n=e.options.container.children[0].children;n=e.rearrange(n);for(var o=function(t,n){return function(){e.setStyle(t,{zIndex:1}),e.moveApart(t,function(){n(),e.setStyle(t,{zIndex:0})})}},i=n.length-1;i>=0;i--)4!=i&&(t=o(n[i],t));return t(),e},n.prototype.moveApart=function(t,n){var o=this,i=o.data(t,"data-row"),r=o.data(t,"data-col"),s=r*this.options.size+r*this.options.spacing,a=i*this.options.size+i*this.options.spacing,p={left:t.style.left,top:t.style.top},l={left:s+"px",top:a+"px"};return new e(t,p,l,o.options.interval).play(n),o},n.prototype.moveToCenterAll=function(t){for(var e=this,n=e.options.container.children[0].children,o=function(t,n){return function(){e.setStyle(t,{zIndex:1}),e.moveToCenter(t,function(){n(),e.setStyle(t,{zIndex:0})})}},i=n.length-1;i>=0;i--)4!=i&&(t=o(n[i],t));return t(),e},n.prototype.moveToCenter=function(t,n){var o=this,i={left:o.options.size+o.options.spacing+"px",top:o.options.size+o.options.spacing+"px"},r={left:t.style.left,top:t.style.top};return new e(t,r,i,o.options.interval).play(n),o},n.prototype.flipAll=function(t){for(var e=this,n=e.options.container.children[0].children,o=0;o<n.length;o++)0==o?e.flip(n[o],t):e.flip(n[o],null);return e},n.prototype.flip=function(t,e){var n=this;return n.flipForward(t,function(){n.switchImage(t).flipBackward(t,e)}),n},n.prototype.flipForward=function(t,n){var o=this,i={transform:"rotateY(90deg)",webkitTransform:"rotateY(90deg)"},r={transform:"rotateY(0deg)",webkitTransform:"rotateY(0deg)"};return new e(t,r,i,o.options.interval).play(n),o},n.prototype.flipBackward=function(t,n){var o=this,i={transform:"rotateY(90deg)",webkitTransform:"rotateY(90deg)"},r={transform:"rotateY(0deg)",webkitTransform:"rotateY(0deg)"};return new e(t,i,r,o.options.interval).play(n),o},n.prototype.switchImage=function(t){for(var e=this,n=t.children,o=0;o<n.length;o++)n[o].style.display="none"==n[o].style.display?"block":"none";return e},n.prototype.convert=function(t){if("object"==typeof t)return 3*t.row+t.col;if("number"==typeof t){var e=t%3,n=Math.floor(t/3);return{row:n,col:e}}throw new Error("position type not defined")},n.prototype.rearrange=function(t){for(var e=this,n=t.length,o=[],i=[],r=0;n>r;r++)i.push(t[r]);for(var s=0,a=0;n>a;a++){var p=Math.floor(Math.random()*i.length),l=i[p];i.splice(p,1);var c=e.convert(s).row,u=e.convert(s).col;e.data(l,"data-row",c),e.data(l,"data-col",u),o.push(l),s++}return o},n.prototype.setStyle=function(t,e){var n=this;return Object.keys(e).forEach(function(n){t.style[n]=e[n]}),n},n.prototype.data=function(t,e,n){return void 0!=n?(t.setAttribute(e,String(n)),t):t.getAttribute(e)},n.prototype.appendWinningImage=function(){for(var t=this,e=t.options.container.children[0].children,n=0;n<e.length;n++)for(var o=e[n].children,i=0;i<o.length;i++)"none"==o[i].style.display&&(o[i].src=t.options.winningImage);return t},n.prototype.pause=function(t){var n=this;return new e(n.options.container,{},{},n.options.interval).play(t),n};var o,i={};return i.init=function(t){o=new n(t)},i.start=function(t,e){"GRID_READY"==o.status&&(o.options.winningImage=t,o.options.callback=e||function(){},o.disturb())},i.bindMessage=function(t,e){o.messenger.on(t,function(t){e(t)})},i.reset=function(){"PRIZE_SHOWN"==o.status&&(o.options.container.innerHTML="",o.status="GRID_READY",o.init())},i}();