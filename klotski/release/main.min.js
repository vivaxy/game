!function(){for(var t=0,e=["ms","moz","webkit","o"],o=0;o<e.length&&!window.requestAnimationFrame;++o)window.requestAnimationFrame=window[e[o]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[o]+"CancelAnimationFrame"]||window[e[o]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var o=(new Date).getTime(),i=Math.max(0,16-(o-t)),n=window.setTimeout(function(){e(o+i)},i);return t=o+i,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var Config=function(){this.blocks=[{type:"player",style:"player",shape:"four-block",position:{x:1,y:0}},{type:"block",style:"block1",shape:"two-vertical",position:{x:0,y:0}},{type:"block",style:"block2",shape:"two-vertical",position:{x:3,y:0}},{type:"block",style:"block3",shape:"two-vertical",position:{x:0,y:2}},{type:"block",style:"block4",shape:"two-vertical",position:{x:3,y:2}},{type:"block",style:"block5",shape:"two-horizon",position:{x:1,y:2}},{type:"block",style:"block6",shape:"one",position:{x:1,y:3}},{type:"block",style:"block7",shape:"one",position:{x:2,y:3}},{type:"block",style:"block8",shape:"one",position:{x:0,y:4}},{type:"block",style:"block9",shape:"one",position:{x:3,y:4}},{type:"exit",position:{x:1,y:4}},{type:"exit",position:{x:2,y:4}}],this.size=Math.min(window.innerWidth/5,window.innerHeight/8),this.border=10,this.row=5,this.col=4,this.container=document.querySelector(".inner-container"),this.outerContainer=document.querySelector(".game-container"),this.stepContainer=document.querySelector(".step"),this.titleContainer=document.querySelector(".header"),this.exit=[{style:"exit",left:1*this.size+this.border,top:5*this.size+this.border,width:this.size,height:this.border},{style:"exit",left:2*this.size+this.border,top:5*this.size+this.border,width:this.size,height:this.border}]},Block=function(t,e,o,i,n){this.container=t,this.selected=!1,this.size=i,this.style=n,this.types={one:[{x:0,y:0}],"two-horizon":[{x:0,y:0},{x:1,y:0}],"two-vertical":[{x:0,y:0},{x:0,y:1}],"four-block":[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}]},this.shape=this.types[e],this.originalPosition={x:o.x,y:o.y},this.move(o),this.element=this.paint()};Block.prototype.move=function(t){for(var e=this,o=0;o<e.shape.length;o++){var i=e.shape[o];e.moveCell(i,t)}},Block.prototype.moveCell=function(t,e){t.x+=e.x,t.y+=e.y},Block.prototype.repaint=function(){var t=this,e=t.element;e.style.top=t.getTopStyle(),e.style.left=t.getLeftStyle()},Block.prototype.paint=function(){var t=this,e=document.createElement("div");return e.style.width=t.getWidthStyle(),e.style.height=t.getHeightStyle(),e.style.top=t.getTopStyle(),e.style.left=t.getLeftStyle(),e.classList.add("block"),t.style&&e.classList.add(t.style),t.container.appendChild(e),e},Block.prototype.getHeightStyle=function(){var t=this;return(t.getBottom()-t.getTop()+1)*t.size+"px"},Block.prototype.getWidthStyle=function(){var t=this;return(t.getRight()-t.getLeft()+1)*t.size+"px"},Block.prototype.getTop=function(){var t=this,e=t.shape[0].y;return t.shape.forEach(function(t){t.y<e&&(e=t.y)}),e},Block.prototype.getTopStyle=function(){var t=this,e=t.getTop();return e*t.size+"px"},Block.prototype.getBottom=function(){var t=this,e=t.shape[0].y;return t.shape.forEach(function(t){t.y>e&&(e=t.y)}),e},Block.prototype.getLeft=function(){var t=this,e=t.shape[0].x;return t.shape.forEach(function(t){t.x<e&&(e=t.x)}),e},Block.prototype.getLeftStyle=function(){var t=this,e=t.getLeft();return e*t.size+"px"},Block.prototype.getRight=function(){var t=this,e=t.shape[0].x;return t.shape.forEach(function(t){t.x>e&&(e=t.x)}),e},Block.prototype.select=function(){var t=this;t.selected=!0,t.element.classList.add("selected")},Block.prototype.unselect=function(){var t=this;t.selected=!0,t.element.classList.remove("selected")},Block.prototype.resetPosition=function(){for(var t=this,e=0;e<t.shape.length;e++){var o=t.shape[e];o.x=0,o.y=0}t.move(t.originalPosition),t.repaint()};var Klotski=function(t){this.container=t.container,this.stepContainer=t.stepContainer,this.titleContainer=t.titleContainer,this.size=t.size,this.step=0,this.gridCells=[],this.player=void 0,this.exit=[],this.blocks=[],this.selected=null,this.init(t),this.isMobile=function(){var t=!1;return function(e){(/(android|ipad|playbook|silk|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(navigator.userAgent||navigator.vendor||window.opera),t}(),this.listen()};Klotski.prototype.init=function(t){var e=this;e.setStyle(t);for(var o=0;o<t.col;o++)for(var i=0;i<t.row;i++){var n={x:o,y:i};e.gridCells.push(n)}for(var r=0;r<t.blocks.length;r++){var s=t.blocks[r];"player"==s.type?e.player=new Block(e.container,s.shape,s.position,e.size,s.style):"block"==s.type?e.blocks.push(new Block(e.container,s.shape,s.position,e.size,s.style)):"exit"==s.type&&e.exit.push(s.position)}},Klotski.prototype.getPosition=function(t,e){return{x:t,y:e}},Klotski.prototype.listen=function(){var t=this,e=t.isMobile?"touchstart":"click";t.container.addEventListener(e,function(e){if(e.preventDefault(),e.stopPropagation(),e.target==t.container){if(!t.selected)return;var o=t.getCellPosition(e);if(!t.isAvailableCell(o))return;var i=t.getNearestCell(t.selected,o),n=t.getDirection(i,o);n&&t.canMove(t.selected,n)&&t.move(n)}else{var r=t.findBlock(e.target);if(r)if(t.selected){var s=!0;t.selected==r&&(s=!1),t.dropDown(),s&&t.pickUp(r)}else t.pickUp(r)}},!1),t.titleContainer.addEventListener(e,t.restart.bind(t),!1)},Klotski.prototype.findBlock=function(t){for(var e=this,o=0;o<e.blocks.length;o++){var i=e.blocks[o];if(t==i.element)return i}return t==e.player.element?e.player:null},Klotski.prototype.pickUp=function(t){var e=this;e.selected||(t.select(),e.selected=t)},Klotski.prototype.dropDown=function(){for(var t=this,e=0;e<t.blocks.length;e++){var o=t.blocks[e];o.unselect()}t.player.unselect(),t.selected=null},Klotski.prototype.getCellPosition=function(t){var e=this,o=e.isMobile?t.touches:[t],i=o[0],n=i.offsetX||i.pageX-(i.target.getBoundingClientRect().left+document.body.scrollTop),r=i.offsetY||i.pageY-(i.target.getBoundingClientRect().top+document.body.scrollTop),s=Math.floor(n/e.size),l=Math.floor(r/e.size);return{x:s,y:l}},Klotski.prototype.canMove=function(t,e){var o=this,i={};i.shape=[];for(var n=0;n<t.shape.length;n++){var r=t.shape[n];i.shape.push({x:r.x,y:r.y})}for(var s=0;s<i.shape.length;s++){var l=i.shape[s];l.x+=e.x,l.y+=e.y}if(o.player!=t&&o.blockOverlapped(o.player,i))return!1;for(var a=0;a<o.blocks.length;a++){var p=o.blocks[a];if(p!=t&&o.blockOverlapped(p,i))return!1}return!0},Klotski.prototype.blockOverlapped=function(t,e){var o=this;if(t==e)return!0;for(var i=0;i<t.shape.length;i++)for(var n=t.shape[i],r=0;r<e.shape.length;r++){var s=e.shape[r];if(o.cellInSamePosition(n,s))return!0}return!1},Klotski.prototype.cellInSamePosition=function(t,e){return t.x==e.x&&t.y==e.y},Klotski.prototype.getNearestCell=function(t,e){for(var o=function(t,e){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)},i=t.shape[0],n=o(i,e),r=1;r<t.shape.length;r++){var s=t.shape[r],l=o(s,e);n>l&&(i=s,n=l)}return i},Klotski.prototype.getDirection=function(t,e){var o=e.x-t.x,i=e.y-t.y;return 0==o?{x:0,y:0>i?-1:1}:0==i?{x:0>o?-1:1,y:0}:void 0},Klotski.prototype.ifWin=function(){for(var t=this,e=0;e<t.exit.length;e++){var o=t.exit[e];if(!t.isCellInBlock(o,t.player))return!1}return!0},Klotski.prototype.isCellInBlock=function(t,e){for(var o=this,i=0;i<e.shape.length;i++){var n=e.shape[i];if(o.cellInSamePosition(t,n))return!0}return!1},Klotski.prototype.isAvailableCell=function(t){var e=this,o=e.player;if(e.isCellInBlock(t,o))return!1;for(var i=0;i<e.blocks.length;i++)if(o=e.blocks[i],e.isCellInBlock(t,o))return!1;return!0},Klotski.prototype.move=function(t){var e=this;e.selected.move(t),e.selected.repaint(),e.updateStep(),e.ifWin()&&(document.title=e.step+" steps moved to get the lightest out #klotski#",e.titleContainer.innerHTML="YOU WIN!")},Klotski.prototype.updateStep=function(){var t=this;t.step++,t.stepContainer.innerHTML=t.step},Klotski.prototype.setStyle=function(t){t.outerContainer.style.width=t.container.style.width=t.col*t.size+"px",t.outerContainer.style.height=t.container.style.height=t.row*t.size+"px",t.outerContainer.style.padding=t.border+"px";for(var e=0;e<t.exit.length;e++){var o=t.exit[e],i=document.createElement("div");i.classList.add(o.style),i.style.left=o.left+"px",i.style.top=o.top+"px",i.style.width=o.width+"px",i.style.height=o.height+"px",t.outerContainer.appendChild(i)}},Klotski.prototype.restart=function(){var t=this;t.selected=null,t.player.unselect(),t.player.resetPosition();for(var e=0;e<t.blocks.length;e++)t.blocks[e].unselect(),t.blocks[e].resetPosition();t.step=0,t.stepContainer.innerHTML=t.step,t.titleContainer.innerHTML="KLOTSKI"},requestAnimationFrame(function(){var t=new Config;new Klotski(t)});